{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8 bg-gray-800 text-white">
    <h1 class="text-2xl font-bold mb-4 text-center animate__animated animate__fadeIn">Hist√≥rico de Altera√ß√µes</h1>

    <!-- Filtro -->
    <div class="bg-gray-700 p-4 rounded-lg shadow-md mb-4 flex items-center justify-between animate__animated animate__fadeIn">
        <div class="flex items-center gap-4">
            <input type="text" name="nome" placeholder="Buscar por Nome..." class="bg-gray-600 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
            <div class="relative">
                <input type="date" name="data" class="bg-gray-600 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600" value="00/00/0000">
                <span class="absolute right-2 top-2 text-gray-400">üìÖ</span>
            </div>
            <select name="tipo" class="bg-gray-600 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                <option value="">Tipo</option>
                <option value="formula">F√≥rmula</option>
                <option value="banco_de_dados">Banco de dados</option>
            </select>
            <select name="status" class="bg-gray-600 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                <option value="">Status</option>
                <option value="ativo">Ativo</option>
                <option value="inativo">Inativo</option>
            </select>
        </div>
        <button type="submit" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-700 transition duration-300">Filtrar</button>
    </div>

    <!-- Tabela -->
    {% if clientes %}
    <div class="overflow-x-auto shadow-lg rounded-lg">
        <table class="min-w-full bg-gray-700 border border-gray-600">
            <thead class="bg-gray-700">
                <tr>
                    <th class="py-2 px-4 text-left text-gray-300 font-semibold">Usu√°rio</th>
                    <th class="py-2 px-4 text-left text-gray-300 font-semibold">Data</th>
                    <th class="py-2 px-4 text-left text-gray-300 font-semibold">Tipo</th>
                    <th class="py-2 px-4 text-left text-gray-300 font-semibold">Status</th>
                    <th class="py-2 px-4 text-left text-gray-300 font-semibold">A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for cliente in clientes %}
                <tr class="border-b border-gray-600 bg-gray-700 hover:bg-gray-600 transition duration-200 animate__animated animate__fadeInUp">
                    <td class="py-2 px-4 bg-gray-700">{{ cliente.nome|default:"Sem nome" }}</td>
                    <td class="py-2 px-4 bg-gray-700">{{ cliente.data_nascimento|date:"d/m/Y"|default:"00/00/0000" }}</td>
                    <td class="py-2 px-4 bg-gray-700">{{ cliente.tipo|default:"F√≥rmula" }}</td>
                    <td class="py-2 px-4 bg-gray-700">
                        <span class="{% if cliente.ativo %}text-green-400{% else %}text-red-400{% endif %} font-medium">
                            {{ cliente.ativo|yesno:"Ativo,Inativo" }}
                        </span>
                    </td>
                    <td class="py-2 px-4 bg-gray-700 flex gap-2">
                        <a href="{% url 'clientes:visualizar_cliente' cliente.id %}" class="text-blue-400 hover:text-blue-600 transition duration-200"><i class="fas fa-eye"></i></a>
                        <a href="{% url 'clientes:editar_cliente' cliente.id %}" class="text-yellow-400 hover:text-yellow-600 transition duration-200"><i class="fas fa-edit"></i></a>
                        <a href="#" class="text-red-400 hover:text-red-600 transition duration-200 open-modal" data-cliente-id="{{ cliente.id }}"><i class="fas fa-trash"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="text-center text-gray-400 font-medium p-6 bg-gray-700 shadow-md rounded-lg animate__animated animate__fadeIn">
        Nenhum cliente cadastrado.
    </div>
    {% endif %}

    <!-- Modal de Confirma√ß√£o de Dele√ß√£o -->
    <div id="deleteModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden">
        <div class="bg-gray-700 rounded-lg p-6 w-full max-w-md animate__animated animate__zoomIn">
            <h2 class="text-lg font-bold text-gray-200 mb-4"><i class="fas fa-exclamation-triangle mr-2 text-red-600"></i>Confirmar Dele√ß√£o</h2>
            <p class="text-gray-400 mb-6">Tem certeza que deseja deletar o cliente "<span id="clienteNome">Sem nome</span>"?</p>
            <div class="flex justify-end gap-4">
                <button id="cancelDelete" class="bg-gray-600 text-gray-200 font-semibold py-2 px-4 rounded-md hover:bg-gray-700 transition duration-300">Cancelar</button>
                <button id="confirmDelete" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-700 transition duration-300">Deletar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('deleteModal');
    const openModalButtons = document.querySelectorAll('.open-modal');
    const cancelButton = document.getElementById('cancelDelete');
    const confirmButton = document.getElementById('confirmDelete');
    const clienteNomeSpan = document.getElementById('clienteNome');

    // Fun√ß√£o para abrir modal de dele√ß√£o
    openModalButtons.forEach(button => {
        button.addEventListener('click', function (e) {
            e.preventDefault();
            const clienteId = this.getAttribute('data-cliente-id');
            const clienteNome = this.parentElement.parentElement.children[0].textContent;
            clienteNomeSpan.textContent = clienteNome;
            confirmButton.setAttribute('data-cliente-id', clienteId);
            modal.classList.remove('hidden');
        });
    });

    cancelButton.addEventListener('click', function () {
        modal.classList.add('hidden');
    });

    confirmButton.addEventListener('click', function () {
        const clienteId = this.getAttribute('data-cliente-id');
        // Adicione aqui a l√≥gica para deletar o cliente (ex.: chamada AJAX ou redirecionamento)
        alert(`Deletando cliente com ID: ${clienteId}. Implemente a l√≥gica de dele√ß√£o aqui!`);
        modal.classList.add('hidden');
    });
});
</script>
{% endblock %}